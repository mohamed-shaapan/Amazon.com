<!DOCTYPE html>
<html>
	
	<!-- DEFINE HEADER -->
	<!-- *********************************************** -->
	<head>

		<link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">
		<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

		<style>
		
			.sh-form{
				width: 540px; padding-top: 20px; padding-bottom: 10px; padding-left: 20px;
			}

			.sh-label{
				width: 100px; padding-top: 6px; padding-right: 10px; text-align: right;
			}

			.sh-input{
				height: 35px;
			}

			.sh-book-attr{
				padding: 2px;
			}

		</style>

	</head>
	


	<!-- DEFINE BODY -->
	<!-- *********************************************** -->
	<body class="w3-light-grey">
		
		<!-- side tabs -->
		<nav class="w3-sidenav w3-card-2 w3-white" style="width:250px">

			<!-- logo -->
			<div class="w3-blue-grey" style="padding-left: 23px; padding-top: 40px; padding-bottom: 30px;">
				<img id="logo_image" alt="logo">
			</div>
		  
		  	<!-- user name -->
		  	<div id="display_user_name" class="w3-container"
		  		style="padding-top: 20px; font-weight: bold; padding-bottom: 10px;">
		  		User_Name
		  	</div>

		  	<!-- customer access -->
			<a id="home_btn" href="#" class="w3-blue-grey">Home</a>
			<a id="account_btn" href="#">Account</a>
			<a id="cart_btn" href="#">Shopping Cart</a>
			<a id="my_orders_btn" href="#">My Orders</a>
			<a id="signout_btn" href="#">Sign Out</a>

			<!-- admin controls -->
			<div id="admin_controls">
				<div class="w3-container" style="padding-top: 20px; font-weight: bold; padding-bottom: 5px;">
					Admin Controls
				</div>
				<a id="manage_inventory_btn" href="#">Manage Inventory</a>
				<a id="manage_publishers_btn" href="#">Manage Publishers</a>
				<a id="publisher_orders_btn" href="#">Publisher Orders</a>
				<a id="user_accounts_btn" ref="#">User Accounts</a>
			</div>

		</nav>
		
		<!-- page content -->
		<div class="w3-container" id="page_content" style="margin-left:250px">
			<div style="height:20px;">
			</div>
			
			<!--search and title-->
			<div class="w3-container" style="margin-bottom:10px;">
				<span class="w3-text-blue-grey" style="font-size:27px; font-weight:bold; font-family: arial;">Best Sellers!</span>
				<button class="w3-btn w3-blue-grey w3-right" style="margin-top:5px;" onclick="$('#search_modal').show()">Search</button>
			</div>

			<!--book table-->
			<div class="w3-container">

				<table id="book_table" class="w3-table-all">

				    <thead>
				      <tr class="w3-dark-grey">
				        <th>Title</th>
				        <th>Price</th>
				        <th></th>
				      </tr>
				    </thead>

				    <tbody>
				    </tbody>
				    
				  </table>
			</div>

			<div id="no_match_msg" class="w3-container w3-xlarge w3-red w3-center" style="margin:16px;">
				No Match Found
			</div>

			
		</div>


		<!-- search modal -->
		<div id="search_modal" class="w3-modal">

			<div id="search_form" class="w3-modal-content w3-animate-zoom w3-card-12" style="width:400px;">

				<header class="w3-container w3-blue-grey">
					<h2 class="w3-xlarge">
						<i class="fa fa-search w3-margin-right w3-margin-left w3-xlarge"></i>
						Search Books
					</h2>
				</header>

				<div class="w3-container w3-margin-top" style="height: 50px;">
					<input id="search_term" type="text" class="w3-input w3-border" required />
				</div>

				<div class="w3-container w3-padding-8">
					<label class="w3-text-grey"><b>Search By</b></label>
				</div>

				<div class="w3-row w3-container" style="padding-bottom: 40px;">

					<div class="w3-col" style="width: 200px; height: 40px;">
						<select id="search_criteria" class="w3-select w3-border w3-small" required >
							<option value="Title" selected >Title</option>
							<option value="Author">Author</option>
							<option value="Publisher">Publisher</option>
						</select>
					</div>

					<div class="w3-col w3-right" style="width: 85px;">
						<button id="search_btn" class="w3-btn w3-green w3-ripple">Search</button>
					</div>

				</div>

			</div>
		
		</div>



		<!-- view new book -->
		<div id="view_book_modal" class="w3-modal">

			<div class="w3-modal-content w3-animate-zoom w3-card-12" style="width:580px; overflow:hidden;">	 

				<header class="w3-container w3-blue-grey w3-tiny">
					<h2 class="w3-large w3-center">book view</h2>
				</header>

				<form id="add_to_cart_form" class="sh-form">

					<!-- user name -->
					<div class="w3-row sh-book-attr">
						<div class="w3-col sh-label">
							<label class="w3-label" style="text-align: right;" >ISBN</label>
						</div>

						<div class="w3-col" style="width: 400px;">
							<input id="book_isbn" type="number" class="w3-input w3-border sh-input" readonly name="book_isbn"/>
						</div>
					</div>

					<!-- password -->
					<div class="w3-row sh-book-attr">
						<div class="w3-col sh-label">
							<label class="w3-label">Title</label>
						</div>

						<div class="w3-col" style="width: 400px;">
							<input id="book_title" type="text" class="w3-input w3-border sh-input" readonly />
						</div>
					</div>

					<!-- first name -->
					<div class="w3-row sh-book-attr">
						<div class="w3-col sh-label">
							<label class="w3-label">Author</label>
						</div>

						<div class="w3-col" style="width: 400px;">
							<input id="book_author" type="text" class="w3-input w3-border sh-input" readonly />
						</div>
					</div>

					<!-- last name -->
					<div class="w3-row sh-book-attr">
						<div class="w3-col sh-label">
							<label class="w3-label">Publisher</label>
						</div>

						<div class="w3-col" style="width: 400px;">
							<input id="book_publisher" type="text" class="w3-input w3-border sh-input" readonly />
						</div>
					</div>


					<!-- user email -->
					<div class="w3-row sh-book-attr">
						<div class="w3-col sh-label">
							<label class="w3-label">Category</label>
						</div>

						<div class="w3-col" style="width: 400px;">
							<input id="book_category" type="text" class="w3-input w3-border sh-input" readonly />
						</div>
					</div>

					<!-- user phone -->
					<div class="w3-row sh-book-attr">
						<div class="w3-col sh-label">
							<label class="w3-label">Price</label>
						</div>

						<div class="w3-col" style="width: 400px;">
							<input id="book_price" type="number" class="w3-input sh-input w3-border" readonly />
						</div>
					</div>

					<!-- shipping address -->
					<div class="w3-row sh-book-attr">
						<div class="w3-col sh-label">
							<label class="w3-label">Year</label>
						</div>

						<div class="w3-col" style="width: 400px;">
							<input id="book_year" type="date" class="w3-input sh-input w3-border"  readonly />
						</div>
					</div>


					<div class="w3-container" style="padding-top: 15px; padding-bottom: 10px;">
						<button class="w3-btn w3-green w3-right" style="margin-right: 2px;" >ADD TO CART</button>
					</div>
				</form>


			</div>
		</div>


	</body>
	



	<!-- POST-LOADING SCRIPTS -->
	<!-- *********************************************** -->
	<script>

		/* hold book data from AJAX request */
		var book_list;

		$(document).ready(function(){

			/* show/hide admin controls */
			/******************************************/
			var display_user_name;
			var view_admin_controls;

			if(view_admin_controls == false){
				$("#admin_controls").remove();
			}
			$("#display_user_name").text(display_user_name);


			/* no match error msg */
			/******************************************/
			$("#no_match_msg").hide();

			/* setup form actions */
			$('#add_to_cart_form').attr('action', '/home/cart');
			$('#add_to_cart_form').attr('method', 'POST');

			/* website logo */
			/******************************************/
			var src_url = "https://www.momdeals.com/vfiles/25-7b9c2f40aedba2587b86dad83e58312f.png";
			$("#logo_image").attr("src", src_url);
			$("#logo_image").attr("height", "60");
			$("#logo_image").attr("width", "200");
			$("#logo_image").css( 'cursor', 'pointer' );
		
			/* hide modal events */
			/******************************************/
			$("#search_modal").hide();
			$("#view_book_modal").hide();
			var search_modal = document.getElementById('search_modal');
			var view_book_modal = document.getElementById('view_book_modal');
			window.onclick = function(event) {
			  if (event.target == search_modal) {
			    $("#search_modal").hide();
			    return;
			  }
			  if (event.target == view_book_modal) {
			    $("#view_book_modal").hide();
			    return;
			  }

			}

			/* view table rows */
			/******************************************/
			/* update rows AJAX */
			var data_url = "http://127.0.0.1:8081/home/refresh_table";
		    $.get(data_url, function(data, status){
		    	
		    	// obtain data
		    	book_list = JSON.parse(data);
		    	update_books_view();
		    });

		    /* search form */
			/******************************************/
		    $('#search_btn').click(function(e){
		    	$('.table_data').remove();
		    	$("#search_modal").hide();

		    	var term = $("#search_term").val();
		    	var criteria = $("#search_criteria").val();
		    	var send_data = { search_term : term, search_criteria : criteria};
		    	var target_url = "http://127.0.0.1:8081/home/search";

				$.post(target_url, send_data, function(data, status){
					// obtain data
			    	book_list = JSON.parse(data);
			    	update_books_view();
				});
			});

		    /* handle site navigation */
			/******************************************/
		    $("#logo_image").click(function(e){
				var target_url = "http://127.0.0.1:8081/home";
      			$( location ).attr("href", target_url);
			});
			$("#account_btn").click(function(e){
				var target_url = "http://127.0.0.1:8081/account";
      			$( location ).attr("href", target_url);
			});
			$("#cart_btn").click(function(e){
				var target_url = "http://127.0.0.1:8081/cart";
      			$( location ).attr("href", target_url);
			});
			$("#my_orders_btn").click(function(e){
				var target_url = "http://127.0.0.1:8081/my_orders";
      			$( location ).attr("href", target_url);
			});
			$("#signout_btn").click(function(e){
				var target_url = "http://127.0.0.1:8081/";
      			$( location ).attr("href", target_url);
			});

			$("#manage_inventory_btn").click(function(e){
				var target_url = "http://127.0.0.1:8081/manage_inventory";
      			$( location ).attr("href", target_url);
			});
			$("#manage_publishers_btn").click(function(e){
				var target_url = "http://127.0.0.1:8081/manage_publishers";
      			$( location ).attr("href", target_url);
			});
			$("#publisher_orders_btn").click(function(e){
				var target_url = "http://127.0.0.1:8081/publisher_orders";
      			$( location ).attr("href", target_url);
			});
			$("#user_accounts_btn").click(function(e){
				var target_url = "http://127.0.0.1:8081/user_accounts";
      			$( location ).attr("href", target_url);
			});

		});


		/*******************************
		left outside for scoping purpose
		********************************/

		/* update view modal fields */
		/******************************************/
		function show_view_book_modal(book_index)
		{
			$("#book_isbn").val(book_list[book_index]["ISBN"]);
			$("#book_title").val(book_list[book_index]["Title"]);
			$("#book_author").val(book_list[book_index]["Author"]);
			$("#book_publisher").val(book_list[book_index]["Publisher"]);
			$("#book_category").val(book_list[book_index]["Category"]);
			$("#book_price").val(book_list[book_index]["Price"]);
			$("#book_year").val(book_list[book_index]["Publication_Year"]);

			$('#view_book_modal').show();
		}


		function update_books_view()
		{
			$("#no_match_msg").hide();
			if(book_list.length == 0){
				$("#no_match_msg").show();
			}
			var i;
	    	for(i=0; i<book_list.length; i++)
	    	{
	    		var tmp_book = book_list[i];
	    		var title = tmp_book["Title"];
	    		var price = tmp_book["Price"];

	    		var view_btn = "<button onclick='show_view_book_modal("+i+")'>view</button>";
	    		var new_row = "<tr class='table_data'><td>"+title+"</td><td>"+price+"</td><td>"+view_btn+"</td></tr>";

	    		$("#book_table > tbody").append(new_row);
	    	}
		}

	</script>
	
</html>